<html>
<body>
Speed Test <hr>



<script src="network.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script type='text/javascript'>
	var serverURLNode = 'http://'+window.location.host+'/speedtest/speedtestserver';
	var settings = {
		endpoint: serverURLPHP,
		delay: 5000,
		data: {
			size:50*1024*1024
		}
	};
	var clientLocation;

	function getHostName(url) {
		var match = url.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);
		if (match != null && match.length > 2 && typeof match[2] === 'string' && match[2].length > 0) {
			return match[2];
		}
		else {
			return '';
		}
	}

	function start(size) {
		//console.log('start:'+size);
		document.getElementById('result').innerHTML += 'testing download speed: duration='+settings.delay/1000+' seconds <br>';
    }

    function progress(avg, instant) {
		//console.log('progress:'+avg/1024/1024);
    }

    function end(avg) {
    	avg = avg * 8 / 1024 / 1024;
		document.getElementById('result').innerHTML += 'result: '+avg.toFixed(2)+' Mbits/sec, or '+(avg/8).toFixed(2)+'MBytes/sec <hr>';
    }
	function restart(size) {
		console.log('restart:'+size);
		console.log('will abort!');
		net.download.abort();
	}
	function test(serverURL) {
		settings.endpoint = serverURL;
		var net = new Network(settings);
		net.download.on('start', start).on('progress', progress).on('restart', restart).on('end', end);
		net.download.start();
		console.log('started! serverURL='+serverURL);
	}

	$.getJSON("http://freegeoip.net/json/", function (data) {
			var country = data.country_name;
			var ip = data.ip;
			document.getElementById('result').innerHTML += 'your ip: '+ip+', location:'+country+'<br>';
	});
	$.getJSON("http://freegeoip.net/json/"+getHostName(serverURLNode), function (data) {
			var country = data.country_name;
			var ip = data.ip;
			document.getElementById('result').innerHTML += 'server ip: '+ip+', location:'+country+'<hr>';
	});
</script>

<input type="button" onclick="test(serverURLNode);" name="ok" value="download speed test"  /> <br>

<hr>

<div id=result></div>

</body>
</html>